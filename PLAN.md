# Melon MP3 Tagger — 프로젝트 계획서

> 최종 업데이트: 2026-02-18

---

## 개요

멜론(melon.com) 앨범 페이지를 크롤링하여 로컬 MP3 파일의 메타데이터를 자동으로 업데이트하는 Python GUI 애플리케이션.

---

## 수집 메타데이터

| 필드 | ID3 태그 | 설명 |
|------|---------|------|
| 노래 제목 | TIT2 | 트랙 제목 |
| 가수명 | TPE1 | 트랙 아티스트 |
| 앨범명 | TALB | 앨범 이름 |
| 앨범아티스트 | TPE2 | 앨범 대표 아티스트 |
| 장르 | TCON | 멜론 제공 장르 |
| 트랙번호 | TRCK | 앨범 내 순서 |
| 앨범아트 | APIC | 앨범 커버 이미지 (JPEG) |

> 향후 추가 가능: 발매 연도(TDRC), 작사/작곡(TEXT/TCOM), 가사(USLT) 등

---

## 기술 스택

| 역할 | 라이브러리 |
|------|-----------|
| GUI | `tkinter` + `ttk` (Python 내장) |
| 웹 크롤링 | `requests` + `BeautifulSoup4` |
| MP3 메타데이터 | `mutagen` (ID3 태그) |
| 이미지 처리 | `Pillow` (앨범아트 리사이징) |

---

## 프로젝트 구조

```
mp3/
├── main.py                  # 실행 진입점
├── requirements.txt
├── PLAN.md
└── melon_tagger/
    ├── __init__.py
    ├── crawler.py           # 멜론 크롤링 엔진
    ├── mp3_handler.py       # mutagen 기반 메타데이터 읽기/쓰기
    └── ui.py                # tkinter GUI (MainWindow, 각 패널 클래스)
```

---

## 크롤링 전략

- **대상 URL**: `https://www.melon.com/album/detail.htm?albumId={ID}`
- **User-Agent**: Chrome 120 (Windows) 헤더 사용
- **파싱 대상**:
  - 앨범명: `.song_name` (inner `<strong>` 제거 후 텍스트)
  - 앨범아티스트: `.artist .artist_name span:first`
  - 장르/발매일: `dl.list` → dt/dd 쌍
  - 앨범아트: `<meta property="og:image">` content
  - 트랙 목록: `tbody tr` 각 행
    - 트랙번호: `.rank` span 텍스트
    - 제목: `a[title*="재생"]` 텍스트
    - 아티스트: `.rank02 a` 링크 텍스트 (중복 제거)
    - Song ID: `input[type=checkbox]` value

---

## GUI 레이아웃

```
┌──────────────────────────────────────────────────┐
│  UrlBar: [멜론 앨범 URL_________________] [크롤링] │
├──────────────────────────────────────────────────┤
│  AlbumInfoPanel │  TrackTreeview                 │
│  [앨범아트]     │  # │ 제목 │ 아티스트 │ 상태    │
│  앨범명: ...    │  1 │ 뱅뱅뱅│ BIGBANG  │ 대기   │
│  아티스트: ...  │  2 │ ...  │ ...      │ ...    │
│  장르: ...      │                                │
├──────────────────────────────────────────────────┤
│  MP3FilePanel                                    │
│  [파일추가] [폴더추가] [자동매칭] [선택제거]       │
│  파일명 │ 트랙# │ 현재제목 │ 현재아티스트 │ 매칭  │
├──────────────────────────────────────────────────┤
│  ActionBar: [선택적용] [전체적용] □백업 □앨범아트  │
├──────────────────────────────────────────────────┤
│  StatusBar: ● 상태메시지  [────────] 매칭 0/0    │
└──────────────────────────────────────────────────┘
```

---

## 매칭 전략 (자동 매칭)

1. **트랙번호 기반**: 파일명 시작이 숫자인 경우 (`01 Title.mp3`, `1. Title.mp3`)
2. **제목 유사도 기반**: 정규화 후 포함 관계 검사
3. **미매칭 표시**: 빨간색으로 "미매칭" 표시 → 수동 매칭 필요

---

## 메타데이터 적용 옵션

- **원본 백업**: `.mp3.bak` 파일 자동 생성 (기본: ON)
- **앨범아트 포함**: APIC 태그에 이미지 임베드 (기본: ON)

---

## 실행 방법

```bash
# 의존성 설치
pip3 install -r requirements.txt

# 앱 실행
python3 main.py
```

---

## 향후 개선 사항

- [x] 드래그 앤 드롭 MP3 파일 추가 (`tkinterdnd2` 라이브러리)
- [ ] 멜론 검색 기능 (앨범 이름으로 검색)
- [ ] 배치 처리 진행률 표시 (트랙별 progressbar)
- [ ] 가사 크롤링 및 적용 (USLT 태그)
- [ ] 다중 앨범 처리 (앨범 큐)
- [ ] 설정 저장/불러오기 (JSON config)
- [ ] PyInstaller를 이용한 단독 실행 파일 패키징
